<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-09-22 Tue 19:09 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to display the Emacs server name in the frame title</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Dan Dee">
<meta name="description" content="Mini-Howto"
>
<meta name="keywords" content="howto, emacs server, server name, frame title, emacs, elisp">
<link rel="preload" as="font" href="/files/fonts/iosevka-curly-slab/woff2/iosevka-curly-slab-extendedthin.woff2" type="font/woff2" crossorigin>
<link rel="stylesheet" href="/static/sanitize/sanitize.css" type="text/css">
<link rel="stylesheet" href="/static/sanitize/forms.css" type="text/css">
<link rel="stylesheet" href="/static/org.css" type="text/css">
<link rel="stylesheet" href="/static/style.css" type="text/css">
<link rel="stylesheet" href="/files/fonts/iosevka-curly-slab/fonts.css" type="text/css">
<link rel="stylesheet" href="/files/fonts/iosevka-curly/fonts.css" type="text/css">
<link rel="stylesheet" href="/files/fonts/alegreya/fonts.css" type="text/css">
<link rel="icon" type="image/svg+xml" href="/files/monkeyjunglejuice.svg">
<link rel="apple-touch-icon" href="/files/monkeyjunglejuice-icon180.png">
<script defer src="/static/head.js"></script>
</head>
<body>
<div id="preamble" class="status">
<nav id="main"><a id="site-name" href="/index.html">MonkeyJungleJuice</a> <a id="github" href="https://github.com/monkeyjunglejuice">Github</a></nav>
</div>
<div id="content">
<header>
<h1 class="title">How to display the Emacs server name in the frame title</h1>
<p class="subtitle">Multiple Emacs servers</p>
</header><p>
As you may know, the usual way to run Emacs is to <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Emacs-Server">start a server instance</a> &#x2014; e.g. at login &#x2014; and use the <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Invoking-emacsclient">Emacs client</a> to edit files.<br>
</p>

<p>
There are some scenarios why one would run <i>more than one</i> Emacs server instance: Maybe to run some Emacs application servers, or to outsource tasks for load balancing reasons.<br>
</p>

<p>
The server feature comes also handy to have separate workspaces, eg. one for coding and a second one for writing &#x2013; like I do (there may be more sophisticated ways to implement workspaces in Emacs tough).<br>
</p>

<p>
Start the servers as shell commands or put the commands into your autostart apps.<br>
</p>
<pre class="example">
$ emacs --daemon=coding
$ emacs --daemon=writing
</pre>

<p>
And then connect via:<br>
</p>
<pre class="example">
$ emacsclient -s writing -nc
</pre>

<p>
I thought it would be nice to see the server name in my frame title to know in which <del>window</del> frame I am (<i>&rsquo;coding&rsquo;</i> or <i>&rsquo;writing&rsquo;</i>). By the way, a &rsquo;frame&rsquo; is the ordinary desktop window in Emacs terminology.<br>
</p>

<p>
The simplest way to set a custom frame title goes like this:<br>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> frame-title-format <span class="org-string">"%b %f"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
<p>
You put the expression into your <code>~/.emacs.d/init.el</code> or <code>~/.emacs</code> file, whatever exists on your system. <code>%b</code> stands for the name of the buffer you&rsquo;re currently in, and <code>%f</code> for the path of the file you&rsquo;re editing. You&rsquo;ll find a <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#g_t_0025_002dConstructs">full list of all variables</a> here.<br>
</p>

<p>
So what to do, if you want to have the server name there? Is there a variable <code>%X</code> for the server name? Of course not.<br>
</p>
<pre class="example">
(setq frame-title-format "%b %f %X")
</pre>

<p>
So we&rsquo;ll need to find another way to put the server name into the string. Luckily, Emacs already provides a variable <code>server-name</code> that holds the name of the Emacs server. The value of <code>server-name</code> is a string, and the <code>concat</code> function puts several strings together into one (you&rsquo;ve noticed the string with a space <code>" "</code> between the quotes? That&rsquo;s the separator between the file path and the server name; we&rsquo;re concatenating 3 strings here). We may do something like that:<br>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> frame-title-format <span class="org-rainbow-delimiters-depth-2">(</span>concat <span class="org-string">"%b %f"</span> <span class="org-string">" "</span> server-name<span class="org-rainbow-delimiters-depth-2">)</span>
</pre>
</div>

<p>
But &#x2026; meh. It&rsquo;s valid code, still doesn&rsquo;t work. &ldquo;server&rdquo; appears in the frame title instead of &ldquo;writing&rdquo;. &ldquo;server&rdquo; is the default value of <code>server-name</code>.<br>
</p>

<p>
Turns out, the server starts towards the end of the initialization, after all the things in &rsquo;init.el&rsquo; have done their thing. We cannot set the frame title just plainly in &rsquo;init.el&rsquo;, because if we do so, the frame title will be set <i>before</i> the server has been started and got its name, still with the default value of <code>server-name</code>.<br>
</p>

<p>
We have to make sure the frame title will be set <i>after</i> the server has started. We can <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Hooks">use a hook</a> for that. There are many standard hooks in Emacs, and we have to <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Init-File">find the right one</a> that runs after the server has been started. According to the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html">startup summary</a>, it seems like the <code>emacs-startup-hook</code> is run before <code>server-start</code> and therefore shouldn&rsquo;t work, but &#x2026; surprise, it works nevertheless!<br>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>add-hook 'emacs-startup-hook
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> frame-title-format
                  <span class="org-rainbow-delimiters-depth-4">(</span>concat <span class="org-string">"%b %f"</span> <span class="org-string">" "</span> server-name<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
What if we want to run Emacs without server mode? In that case, the default value of <code>server-name</code> will be shown again. To get rid of it, we&rsquo;ll have to extend the <code>setq</code> form a bit. Finally :) You can put that into your &rsquo;init.el&rsquo;:<br>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>add-hook 'emacs-startup-hook
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span>
            <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">setq</span> frame-title-format
                  <span class="org-rainbow-delimiters-depth-4">(</span>concat <span class="org-string">"%b %f"</span>
                          <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-6">(</span>not <span class="org-rainbow-delimiters-depth-7">(</span>equal server-name <span class="org-string">"server"</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
                            <span class="org-rainbow-delimiters-depth-6">(</span>concat <span class="org-string">" "</span> server-name<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Or even better &#x2013; let&rsquo;s define a separate named function to set the frame title. That looks a bit more tidy when you hook more than one functions into <code>emacs-startup-hook</code>:<br>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">my-frame-title</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Set a custom frame title."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> frame-title-format
        <span class="org-rainbow-delimiters-depth-3">(</span>concat <span class="org-string">"%b %f"</span>
                <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-5">(</span>not <span class="org-rainbow-delimiters-depth-6">(</span>equal server-name <span class="org-string">"server"</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
                  <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-string">" "</span> server-name<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Then run the hook to call the function:<br>
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>add-hook 'emacs-startup-hook
          <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">()</span>
            <span class="org-rainbow-delimiters-depth-3">(</span>my-frame-title<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div id="outline-container-orgbc255e1" class="outline-2">
<h2 id="orgbc255e1">Conclusion</h2>
<div class="outline-text-2" id="text-orgbc255e1">
<p>
You can (mis)use the principle for other things, like have a different theme for each server instance, or &#x2026; let me know in the comments what you are doing with multiple Emacs servers :)<br>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="footer">Published: <span class="date">2020-09-21 Mon 00:00</span> by <span class="author">Dan Dee</span> <span class="email"><a href="mailto:MonkeyJungleJuice@pm.me">MonkeyJungleJuice@pm.me</a></span></p>
<div class="comments">
<h2>Comments</h2>
<div id="disqus_thread"></div><script>(function() { var d = document, s = d.createElement('script'); s.src = 'https://monkeyjunglejuice.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>
</body>
</html>
